# EarthLord 产品需求文档 (PRD)

## 文档信息
| 项目 | 内容 |
|------|------|
| 产品名称 | EarthLord (地主) |
| 版本 | 1.0 |
| 平台 | iOS |
| 文档日期 | 2025-12-23 |

---

## 1. 产品概述

### 1.1 产品背景
EarthLord是一款基于LBS（Location-Based Service）的末日生存游戏。玩家通过真实世界的行走来圈占虚拟土地，探索真实地标获取资源，建设自己的领地，并与其他玩家进行交易和社交互动。

### 1.2 产品定位
- **目标用户**: 喜欢户外运动、生存游戏、社交互动的18-35岁用户
- **核心价值**: Walk to Earn - 用真实的行走换取虚拟世界的成就
- **竞品参考**: Pokemon GO、Ingress、Keep

### 1.3 产品愿景
打造全球首款"用脚步丈量你的王国"的LBS生存游戏，让玩家在现实世界中重建末日后的文明。

---

## 2. 世界观设定

### 2.1 故事背景
- **2048年**: "世界战争"爆发，全球文明在72小时内崩塌，99%的人口消失
- **2051年**: 幸存者从废墟中走出，《新开拓者协议》颁布
- **核心法则**: "凡以双足丈量之无主土地，皆为开拓者所有"

### 2.2 视觉风格
**"希望朋克"** - 废土之上的新生，绝望中的希望
- 废弃建筑上生长的绿色植物
- 末日风格的卫星地图界面
- 充满希望的新生标志

---

## 3. 核心功能需求

### 3.1 用户系统

#### 3.1.1 登录注册
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| AUTH-001 | 支持邮箱注册登录 | P0 |
| AUTH-002 | 支持Apple ID一键登录 | P0 |
| AUTH-003 | 支持Google账号登录 | P0 |
| AUTH-004 | 支持密码重置功能 | P1 |
| AUTH-005 | 支持邮箱验证 | P1 |
| AUTH-006 | 支持多设备登录管理 | P2 |

**技术方案**: Supabase Auth

#### 3.1.2 用户档案
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| PROFILE-001 | 显示幸存者等级 | P0 |
| PROFILE-002 | 显示开拓天数 | P0 |
| PROFILE-003 | 显示领地数量和总面积 | P0 |
| PROFILE-004 | 显示建筑数量 | P1 |

---

### 3.2 圈地系统

#### 3.2.1 GPS圈地
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| LAND-001 | 实时GPS定位并显示在地图上 | P0 |
| LAND-002 | 点击"开始开拓"后记录行走轨迹 | P0 |
| LAND-003 | 轨迹实时绘制为蓝色线条 | P0 |
| LAND-004 | 回到起点附近自动闭合形成多边形 | P0 |
| LAND-005 | 验证圈地合法性(无作弊、无重叠) | P0 |
| LAND-006 | 计算并显示圈地面积 | P0 |

**技术方案**: Apple MapKit + CoreLocation

#### 3.2.2 领地管理
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| TERR-001 | 支持为领地命名 | P0 |
| TERR-002 | 显示领地详情(面积、建筑数) | P0 |
| TERR-003 | "允许交易"开关控制 | P1 |
| TERR-004 | 领地30天未建设自动回收 | P2 |
| TERR-005 | 领地90天不活跃自动回收 | P2 |

**技术方案**: Supabase + PostGIS

---

### 3.3 探索系统

#### 3.3.1 POI发现
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| POI-001 | 自动识别玩家附近的真实地标 | P0 |
| POI-002 | 进入POI范围后弹出发现提示 | P0 |
| POI-003 | 支持搜刮操作获取资源 | P0 |
| POI-004 | 不同类型POI产出不同资源 | P0 |

**POI类型与资源映射**:
| POI类型 | 产出资源 |
|---------|----------|
| 医院/药店 | 药品(急救包、抗生素) |
| 超市/餐厅 | 食物(罐头、饮用水) |
| 工厂/工地 | 金属材料 |
| 公园/林地 | 木材 |
| 银行/珠宝店 | 稀有材料 |

**技术方案**: Apple MapKit POI API

#### 3.3.2 探索成就
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| EXP-001 | 记录探索距离 | P0 |
| EXP-002 | 记录探索时长 | P0 |
| EXP-003 | 显示获得的物品清单 | P0 |

---

### 3.4 背包系统

#### 3.4.1 物品管理
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| BAG-001 | 显示背包容量(如41/100) | P0 |
| BAG-002 | 物品分类展示 | P0 |
| BAG-003 | 物品数量显示 | P0 |
| BAG-004 | 物品使用功能 | P1 |
| BAG-005 | 物品丢弃功能 | P2 |

**技术方案**: 本地优先架构 + 云端同步

---

### 3.5 建造系统

#### 3.5.1 建筑建造
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| BUILD-001 | 建筑分类浏览(生存/储存/生产/能源) | P0 |
| BUILD-002 | 显示建造所需资源 | P0 |
| BUILD-003 | 资源检查(足够则允许建造) | P0 |
| BUILD-004 | 拖动选择建造位置 | P0 |
| BUILD-005 | 建造消耗对应资源 | P0 |

**建筑等级**: Tier 1(生存基础) → Tier 2(功能扩展) → Tier 3(高级设施)

#### 3.5.2 建筑状态
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| STATE-001 | 支持建筑状态流转 | P0 |
| STATE-002 | 只有激活状态的建筑可升级 | P1 |
| STATE-003 | 损坏的建筑需要维修 | P2 |

**建筑状态**: 建造中 → 待激活 → 运行中 → 损坏

---

### 3.6 交易系统

#### 3.6.1 物物交易
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| TRADE-001 | 发布交易挂单(我提供/我需要) | P0 |
| TRADE-002 | 浏览附近玩家的挂单 | P0 |
| TRADE-003 | 接受交易完成物品交换 | P0 |
| TRADE-004 | 100米范围内可发现对方挂单 | P1 |

---

### 3.7 通讯系统

#### 3.7.1 消息中心
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| MSG-001 | 官方消息推送 | P0 |
| MSG-002 | 生存指南消息 | P1 |
| MSG-003 | 每日任务消息 | P1 |
| MSG-004 | 官方公告消息 | P1 |

#### 3.7.2 公共频道
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| CHAT-001 | 基于位置的公共聊天(3km范围) | P0 |
| CHAT-002 | 实时消息发送和接收 | P0 |
| CHAT-003 | 显示频道覆盖范围 | P1 |

**技术方案**: Supabase Realtime

#### 3.7.3 频道管理
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| CH-001 | 浏览频道列表 | P0 |
| CH-002 | 创建私人频道 | P1 |
| CH-003 | 加入/退出频道 | P0 |
| CH-004 | 显示频道距离和在线人数 | P1 |

#### 3.7.4 PTT呼叫
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| PTT-001 | 长按发送语音消息 | P1 |
| PTT-002 | 显示当前频率 | P2 |

#### 3.7.5 设备等级
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| DEV-001 | 收音机(只能收听) | P0 |
| DEV-002 | 对讲机(收发3km) | P0 |
| DEV-003 | 营地电台(10km) | P1 |
| DEV-004 | 卫星通讯(全球) | P1 |

---

### 3.8 成就与排行系统

#### 3.8.1 排行榜
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| RANK-001 | 领地面积排行榜 | P0 |
| RANK-002 | 探索废墟排行榜 | P0 |
| RANK-003 | 建筑数量排行榜 | P1 |
| RANK-004 | 显示个人排名 | P0 |

#### 3.8.2 成就系统
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| ACH-001 | 成就分类展示 | P0 |
| ACH-002 | 成就完成度统计 | P0 |
| ACH-003 | 成就奖励发放 | P1 |
| ACH-004 | 成就稀有度(普通/稀有/史诗/传说) | P2 |

---

### 3.9 生存系统

#### 3.9.1 生存体征
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| VITAL-001 | 核心生命值显示 | P0 |
| VITAL-002 | 饱食度显示和衰减 | P0 |
| VITAL-003 | 水分显示和衰减 | P0 |
| VITAL-004 | 80%以上获得增益效果 | P1 |
| VITAL-005 | 数值过低开始掉血 | P1 |

**衰减规则**:
- 饥饿: 每小时-5
- 口渴: 每小时-10

---

### 3.10 商业化系统

#### 3.10.1 内购系统
| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| IAP-001 | 订阅制: 开拓者月卡 $9.99/月 | P0 |
| IAP-002 | 订阅制: 领主通行证 $19.99/月 | P0 |
| IAP-003 | 一次性购买: 初级物资包 $0.99 | P1 |
| IAP-004 | 一次性购买: 中级物资包 $2.99 | P1 |
| IAP-005 | 一次性购买: 稀有资源包 $9.99 | P1 |

**技术方案**: StoreKit 2

---

### 3.11 多语言支持

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| I18N-001 | 简体中文支持 | P0 |
| I18N-002 | 繁体中文支持 | P1 |
| I18N-003 | 英文支持 | P0 |
| I18N-004 | 语言切换后重启应用 | P0 |

---

## 4. 非功能需求

### 4.1 性能需求
| 需求ID | 需求描述 |
|--------|----------|
| PERF-001 | GPS定位延迟 < 2秒 |
| PERF-002 | 消息送达延迟 < 1秒 |
| PERF-003 | 排行榜查询 < 500ms |
| PERF-004 | 支持10万级用户并发 |

### 4.2 可用性需求
| 需求ID | 需求描述 |
|--------|----------|
| AVAIL-001 | 离线可查看背包和领地 |
| AVAIL-002 | 网络恢复自动同步 |

### 4.3 安全需求
| 需求ID | 需求描述 |
|--------|----------|
| SEC-001 | GPS防作弊机制 |
| SEC-002 | 交易数据加密 |
| SEC-003 | 用户数据隐私保护 |

---

## 5. 技术架构

### 5.1 技术栈
| 层级 | 技术选型 |
|------|----------|
| 客户端 | iOS (Swift/SwiftUI) |
| 地图服务 | Apple MapKit |
| 定位服务 | CoreLocation |
| 后端服务 | Supabase |
| 数据库 | PostgreSQL + PostGIS |
| 实时通讯 | Supabase Realtime |
| 支付系统 | StoreKit 2 |
| 认证系统 | Supabase Auth |

### 5.2 核心代码模块
| 功能 | 代码文件 |
|------|----------|
| 登录注册 | AuthManager.swift |
| GPS圈地 | LocationManager.swift |
| 领地管理 | TerritoryManager.swift |
| POI发现 | POIManager.swift |
| 探索搜刮 | ExplorationManager.swift |
| 背包系统 | ItemManager.swift |
| 建造系统 | BuildingManager.swift |
| 交易系统 | TradeManager.swift |
| 消息中心 | RadioManager.swift |
| 实时聊天 | CommunicationManager.swift |
| 频道管理 | ChannelManager.swift |
| 内购支付 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就系统 | AchievementManager.swift |
| 生存体征 | VitalSignsManagerV2.swift |

---

## 6. 版本规划

### 6.1 MVP版本 (v1.0)
- 登录注册系统
- GPS圈地系统
- 领地管理
- POI探索与搜刮
- 背包系统
- 基础建造系统
- 公共频道聊天

### 6.2 v1.1 版本
- 交易系统
- 频道管理
- 排行榜
- 成就系统

### 6.3 v1.2 版本
- 生存体征系统
- PTT呼叫
- 设备等级
- 内购系统

### 6.4 v2.0 版本
- 多语言支持
- 联盟系统
- 更多建筑类型
- 全球服务器

---

## 7. 成功指标

| 指标类型 | 指标名称 | 目标值 |
|----------|----------|--------|
| 用户增长 | DAU | 10,000 |
| 用户留存 | 次日留存 | 40% |
| 用户留存 | 7日留存 | 20% |
| 用户活跃 | 日均使用时长 | 30分钟 |
| 商业化 | 付费转化率 | 5% |
| 商业化 | ARPU | $2 |

---

*文档结束*
